<ion-header no-border>
  <ion-navbar color="navbar-color">
    <div>
      <img src="./assets/icons/logo.svg" [ngClass]="db.isAndroid() ? 'android-logo' : 'ios-logo'">
    </div>

    <ion-buttons end>
      <button ion-button icon-only (click)="openDropdownMenu($event)">
        <div>
          <div *ngIf="db.currentUser" style="margin: 2.5px; font-size: 13px">
            {{db.currentUser.fullname}}
          </div>

          <div style="float: right; margin: 2.5px; font-size: 13px">
            <span *ngIf="db.currentUser && db.currentUser.adminRole == 'true'">Admin</span>
            <span *ngIf="db.currentUser && db.currentUser.adminRole == 'false'">Borrower</span>
          </div>
        </div>
      </button>

      <button ion-button icon-only (click)="openDropdownMenu($event)">
        <img [src]="db.currentUserPhotoURI" [ngClass]="db.isAndroid() ? 'facebook-image-android' : 'facebook-image-ios'">
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>


<ion-content padding>

  <div *ngIf="pendingLoans && pendingLoans.length != 0" class="scroll-bar">
    <div *ngFor="let pendingLoan of pendingLoans" class="scroll-bar-element">
      <h6>{{pendingLoan.pendingLoan.itemOwnerName}} wants to lend you</h6>
      <div class="item-container">
        <img [src]="pendingLoan.photoURL" class="item-image" />
        <div class="item-name">
          {{trimString(pendingLoan.name)}}  <span class = "entity-info">from {{trimString(pendingLoan.entityName)}}</span>
        </div>
      </div>
      <div class="return-date">Return date: {{pendingLoan.pendingLoan.formattedDate}}</div>
      <div class="item-container-buttons">
        <button class="dismiss-button" (click)="dismissLoan(pendingLoan)">
          <div class="button-text">
            <b>Dismiss</b>
          </div>
        </button>
        <button class="confirm-button" (click)="acceptLoan(pendingLoan)">
          <div class="button-text">
            <b>Confirm</b>
          </div>
        </button>
      </div>
    </div>
  </div>



  <div class="button-container">
    <button class="grey-button" (click)="goToItemlistUserPage()">
      <div>
       <img src="./assets/icons/items.svg" class="grey-button-icon">
        <div class="grey-button-text-container">
          <div class="grey-button-text-title">
            Full list of items
          </div><br>
          <div class="grey-button-text-info">
            <div class="grey-button-text">{{numberOfItems}} items you can borrow</div>
          </div>
        </div>
      </div>
    </button>

    <button [ngClass]="currentEntity != 'No entity, join an entity to get started' ? 'grey-button' : 'grey-button-glowing'" (click)="goToEntityUserPage()">
      <div>
        <img src="./assets/icons/entities.svg" class="grey-button-icon">
        <div class="grey-button-text-container">
          <div class="grey-button-text-title">
            Entity
          </div><br>
          <div class="grey-button-text-info">
            <div class="grey-button-text">{{currentEntity}}</div>
          </div>
        </div>
      </div>
    </button>
  </div>

  <h3 style="margin-top: 20px;" *ngIf="map && map.length != 0">New entity</h3>

  <div *ngIf="map && map.length != 0">
    <div *ngFor="let map of map" class="scroll-bar-element">
      <div class="tag-text">
        You have been accepted to {{map.entityName}}
      </div>
      <div>
        <button class="ok-button" (click)="ok(map)">
          <div class="button-text">
            <b>Ok</b>
          </div>
        </button>
        <button class="confirm-button" (click)="goTo(map)">
          <div class="button-text">
            <b>Go To</b>
          </div>
        </button>
      </div>
    </div>
  </div>

  <h3 style="margin-top: 20px;" *ngIf="db.currentUser && db.currentUser.requestTagId">NFC Tag request</h3>

  <div *ngIf="db.currentUser && db.currentUser.requestTagId">
    <div class="tag-text">
      An admin wants to register a NFC user tag for you
    </div>
    <div>
      <button class="dismiss-button" (click)="declineUserTag()">
        <div class="button-text">
          <b>Dismiss</b>
        </div>
      </button>
      <button class="confirm-button" (click)="acceptUserTag()">
        <div class="button-text">
          <b>Accept</b>
        </div>
      </button>
    </div>
  </div>

  <h3 style="margin-top: 20px;" *ngIf="reservations && reservations.length != 0">You have reserved</h3>

  <div *ngIf="reservations && reservations.length != 0" class="scroll-bar">
    <div *ngFor="let reservation of reservations" class="scroll-bar-element">
      <div class="reservations-container">
        <img [src]="reservation.itemPhoto" class="item-image" />
        <div class="item-name">
          <div>{{trimString(reservation.itemName)}}  <ion-icon name="close" class="close-icon" (click)="removeReservation(reservation)"></ion-icon></div>
          <div class = "entity-info">Entity: {{trimString(reservation.entityName)}}</div>
          <div class="dueDate"><span>Pickup date: {{reservation.formattedShortpUpDate}} ({{dueDate(reservation.pickupDate)}})</span></div>
          <div class="dueDate" *ngIf="dueDate(reservation.pickupDate)=='Today'">Reservation will be deleted tomorrow</div>
        </div>
      </div>
    </div>
  </div>

  <h3 style="margin-top: 20px;" *ngIf="loans && loans.length != 0">You are currently borrowing</h3>

  <div *ngIf="loans && loans.length != 0" class="scroll-bar">
    <div *ngFor="let loan of loans" class="scroll-bar-element">
      <div class="borrowed-container">
        <img [src]="loan.photoURL" class="item-image" />
        <div class="item-name">
          <div>{{trimString(loan.name)}}</div>
          <div class = "entity-info">Entity: {{trimString(loan.entityName)}}</div>
          <div class="dueDateBorrowed">Return date: {{loan.loan.formattedShortDate}} <span *ngIf="dueDate(loan.loan.timeInMillis)!='expired'">({{dueDate(loan.loan.timeInMillis)}})</span></div>
          <div class="dueDateBorrowed" *ngIf="dueDate(loan.loan.timeInMillis)=='expired'">LOAN EXPIRED - PLEASE RETURN</div>
        </div>
      </div>
    </div>
  </div>
      
</ion-content>
